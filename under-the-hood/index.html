



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Manage your Docker Host on the go">
      
      
        <link rel="canonical" href="https://davidkroell.github.io/docker2go/under-the-hood/">
      
      
        <meta name="author" content="David Kröll, Christopher Hummel">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>Under the hood - Docker2go</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.11e41852.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#ef5350">
      
    
    
      <script src="../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="manifest" href="../manifest.webmanifest">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="red" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#under-the-hood" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://davidkroell.github.io/docker2go/" title="Docker2go" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Docker2go
              </span>
              <span class="md-header-nav__topic">
                Under the hood
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/davidkroell/docker2go/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      davidkroell/docker2go
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="Overview" class="md-tabs__link md-tabs__link--active">
        Overview
      </a>
    
  </li>

      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://davidkroell.github.io/docker2go/" title="Docker2go" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Docker2go
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/davidkroell/docker2go/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      davidkroell/docker2go
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Under the hood
      </label>
    
    <a href="./" title="Under the hood" class="md-nav__link md-nav__link--active">
      Under the hood
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#layout" title="Layout" class="md-nav__link">
    Layout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multithreading" title="Multithreading" class="md-nav__link">
    Multithreading
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-and-docker-objects-paradigm" title="Command and Docker objects paradigm" class="md-nav__link">
    Command and Docker objects paradigm
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#layout" title="Layout" class="md-nav__link">
    Layout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multithreading" title="Multithreading" class="md-nav__link">
    Multithreading
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-and-docker-objects-paradigm" title="Command and Docker objects paradigm" class="md-nav__link">
    Command and Docker objects paradigm
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/davidkroell/docker2go/tree/master/docs/under-the-hood.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="under-the-hood">Under the hood<a class="headerlink" href="#under-the-hood" title="Permanent link">&para;</a></h1>
<p>This chapter will give you a brief overview about the technical aspects of the Docker2go app.
The code snippets should help you to understand the concepts.</p>
<h2 id="layout">Layout<a class="headerlink" href="#layout" title="Permanent link">&para;</a></h2>
<p>The layout is implemented as a card layout and most of the time leverages a <code>ListView</code> to display entries.
The ListView in <code>ConnectionActivity</code> is served from a local SQLite Database accessed by SugarORM.</p>
<p>On connecting, a new Activity gets displayed which is based on a <code>TabbedActvity</code>.
The three Tabs (Information, Containers, Images) are implemented as <code>Fragments</code>.
In those fragments are different layouts implemented.
But they all share the <code>SwipeToRefresh</code> paradigm which should help to make Docker2go more usable.</p>
<p>Additionally, on the containers Tab (<code>TabContainers</code>) a BottomSheet gets displayed by clicking on a ListViewItem.
This BottomSheet gives you some basic actions based on the containers state and shows more details information.
For example the Docker Image is displayed in the BottomSheet whereas its not visible in the ListView.  </p>
<p>The activity parent (<code>OverviewActivity</code>) of the Fragments holds the Connection object in order to call the remote Docker API.</p>
<h2 id="multithreading">Multithreading<a class="headerlink" href="#multithreading" title="Permanent link">&para;</a></h2>
<p>Every netowork based operation is done concurrently inside a <code>AsyncTask</code> in order to not freeze the userinterface on long lasting operations.
The <code>Connection</code> class provides the method <code>executeCommand()</code> which lets you execute one or more command on a remote host.
For executing command on remote hosts the <code>AsyncTaskCommandExecutor</code> class is used.
Every call to <code>executeCommand()</code> is encapsulated in a single <a href="..#third-party-libraries">JSch</a> connection.</p>
<div class="codehilite"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPreExecute</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// establish a secure connection to remote host</span>
<span class="o">}</span>
</pre></div>


<p>This class is able to execute one or more commands which must implement the <code>Command</code> interface.</p>
<div class="codehilite"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="n">CommandExecutionSummary</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">Command</span><span class="o">...</span> <span class="n">commands</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="c1">// connect to remote host</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jschSession</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>

        <span class="c1">// Execute single command and use onProgressUpdate for output</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Command</span> <span class="n">command</span> <span class="o">:</span> <span class="n">commands</span><span class="o">)</span> <span class="o">{</span>

            <span class="n">Command</span> <span class="n">c</span> <span class="o">=</span> <span class="n">execCommand</span><span class="o">(</span><span class="n">command</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">ces</span><span class="o">.</span><span class="na">addCommand</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>

            <span class="c1">// calls method onProgressUpdate</span>
            <span class="c1">// which then call onCommandFinished</span>
            <span class="n">publishProgress</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ces</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="c1">// exceptions in CommandExecutionSummary can be retrieved in GUI classes</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ces</span><span class="o">.</span><span class="na">addException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ces</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="c1">// make sure to close the connection</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jschSession</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Docker2go leverages a listener pattern as seen in the above example.
The listener class is a parameter of <code>executeCommand()</code> which will then call the methods <code>onCommandFinished()</code>
or <code>onAllCommandsFinished()</code> depending of the state of the AsyncTask.
The results of the Commands are part of the Command itself which is returned by the <code>onCommandFinished()</code> method.</p>
<h2 id="command-and-docker-objects-paradigm">Command and Docker objects paradigm<a class="headerlink" href="#command-and-docker-objects-paradigm" title="Permanent link">&para;</a></h2>
<p>Docker2go depends highly on the use of interfaces.
The <code>Command</code> is one of those abstract interfaces.
The Command interface is implemented by <code>DockerCommandBuilder</code> which lets you build your command
by utilizing a fluent API.</p>
<div class="codehilite"><pre><span></span><span class="n">DockerCommandBuilder</span> <span class="n">command</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DockerCommandBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">apiEndpoint</span><span class="o">(</span><span class="s">&quot;/containers/json&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">&quot;all&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">requestMethod</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">);</span>

<span class="n">parentActivity</span><span class="o">.</span><span class="na">activeConnection</span><span class="o">.</span><span class="na">executeCommand</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">command</span><span class="o">);</span> 
</pre></div>


<p>The <code>this</code> in the code snippet above is the listener class described in seciton <a href="#multithreading">Multithreading</a>.
Special in Docker2go's implementation is, that the GUI classes never talk directly to the AsyncTask
in the background. Every operation is cooridinated by the Connection class.</p>
<p>The results of the command are stored as string and can be accessed by calling the <code>getResult()</code> method of the <code>Command</code>.
The results are in JSON format which gets parsed by one of <code>DockerObjParser</code> static methods.
DockerObjParser utilizes the Gson library to make the parsing process more convinient.</p>
<div class="codehilite"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCommandFinished</span><span class="o">(</span><span class="n">Command</span> <span class="n">command</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">command</span><span class="o">.</span><span class="na">exitedAsExpected</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">DockerContainer</span><span class="o">[]</span> <span class="n">dContainers</span> <span class="o">=</span> <span class="n">DockerObjParser</span><span class="o">.</span><span class="na">Containers</span><span class="o">(</span><span class="n">command</span><span class="o">.</span><span class="na">getResult</span><span class="o">());</span>

            <span class="n">containers</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
            <span class="n">containers</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">dContainers</span><span class="o">));</span>

            <span class="n">containerArrayAdapter</span><span class="o">.</span><span class="na">notifyDataSetChanged</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>The example above shows how the list of containers is refreshed by overriding the <code>onCommandFinished()</code> method.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../installation/" title="Installation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Installation
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 David Kröll, Christopher Hummel
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/davidkroell" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://github.com/evilpro" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>